---
title: "Survey_analysis"
author: "MDP"
date: "13/10/2021"
output: 
  html_document:
    toc: true
    toc_depth: 2
    theme: readable
    section_numbers: 3
editor_options: 
  chunk_output_type: console
---

<!-- The line below is a directive for .html output to adequate the maximum width 
to 80% of the window -->


<style type="text/css">
.main-container {
  max-width: 75%;
  margin-left: auto;
  margin-right: auto;
}
body {text-align: justify}
</style>

--- 

# Introduction

We will analyze the data coming from the ExpMed GSS about experiences of students in the program. It contains information about the characteristics of the student, their funding (received and applied for), the courses they have taken and opinions about different aspects of the program and the graduate student experience in our program. 

## Data import and data wrangling

In this analysis we employed the `tidyverse` for organization and `kableExtra` to improve the quality of our tables. We import the dataset using the `qualtric` package to import data. 

I transform all character variables to factors and drop unneeded variables. 

We also  extract a list of variable descriptions for our reference and create a few wrapper function for tables and plots to avoid repeating code and keeping results uniform.

```{r, echo=FALSE}
library(tidyverse)
library(qualtRics)
library(kableExtra)
library(ggpubr)
library(ggsci)
```

```{r, results='hide'}
survey<- read_survey(file_name = "./input/20210804-GSS_survey.csv", 
                     legacy = F,
                     import_id = F
                     ) %>%
  as_tibble() %>% 
  mutate(across(where(is.character), as_factor))

# colnames collected inside a label, names show only ID
colnames(survey)[40:45]

# eliminate unnecessary columns with text
survey1 <- survey %>%  
  select(Progress, starts_with("Q"), -contains("Text"), -Q_BallotBoxStuffing)
```

```{r, include=FALSE, results='hide'}
questions_guide<- extract_colmap(survey1) %>%
  select(qname, description) 

glimpse(questions_guide)
```

```{r, include=FALSE, results='hide'}
#######################  frequency table 
count_wrapper <- function (data, var, total=82) {
  count(data, {{var}}) %>% 
    mutate(freq=n/total*100) 
}
#######################  formatted html kbl 
formatted_kbl <- function (data, colnames=NA) {
  kbl(data, format="html", align = c("lcccc"), row.names = NA, digits=2, col.names = colnames) %>%
    kable_styling(font_size = 25, bootstrap_options = "striped",  full_width = F) %>%
    kable_classic()
}
#######################  formatted faceted bar plot
grouped_bar_wrapper <- function (data, x, group, 
                                 plot.title="", x.title="", 
                                 facet_label="top", palette="red") 
{
  plot<-  ggplot(data, 
                 aes(x={{x}},fill=as.factor({{group}}))) + 
    geom_bar()
  plot <-  plot +  facet_wrap(vars({{group}}), 
                              scales = "free_x", 
                              strip.position=facet_label)
  plot <-  plot +labs(title=plot.title,
                      fill="Graduate program",
                      x=x.title,
                      y="")
  plot <-  plot +  theme(axis.text.x = element_text(angle = 90),
                         plot.title = element_text(size=16, hjust=0.5),
                         panel.background = element_blank(),
                         strip.text.x = element_text(size = 10),
                         legend.position = "none")
  # Conditional fill colors
  if (palette=="green")
  {plot + scale_fill_manual(values=c("darkorchid4", "forestgreen"))}
  else 
  {plot + scale_fill_manual(values=c("darkcyan","brown3"))}
}
####################### formatted single col plot --> imported questions
single_col_wrapper <-  function(data, x.var, n, title="") {
  plot <- ggplot(data=data, 
                 aes(x={{x.var}}, y={{n}}, fill=factor({{x.var}})))
  plot <- plot + geom_col() +
    labs(title=title, 
         x="", 
         y="")
  plot <- plot + scale_fill_nejm()
  plot <- plot + theme(plot.title = element_text(size=16, hjust=0.5),
                       panel.background = element_blank(),
                       legend.position = "none",
                       axis.text.x = element_text(angle=45, vjust=0.5),
                       axis.line = element_line(colour = "black"))
  plot
}
####################### formatted histogram
geom_hist_wrapper <-  function(data, x.var, y.var=n, 
                               palette="BuGn", title="", facet_label="top",
                               rev_palette=F) {
  
  colors<- RColorBrewer::brewer.pal(9, palette)[3:9] 
  # reverse=T determines if we reverse the color palette
  if (rev_palette==T) {colors <- rev(colors)}
  else {colors <- colors}
  plot <- ggplot(data, 
                 aes(x={{x.var}}, y={{y.var}}, fill={{x.var}})) +
    geom_histogram(stat = "identity", position = "dodge") 
  plot <- plot + scale_fill_manual(values = colors) 
  plot <- plot + theme(axis.text.x = element_blank(),
                       axis.ticks.x = element_blank(),
                       legend.position="right",
                       strip.text.x = element_text(size = 10),
                       plot.title = element_text(size=16, hjust=0.5),
                       legend.title = element_blank(),
                       panel.background = element_blank(),
                       legend.text = element_text(size = 8)
  )
  plot + labs(title=title,
              x="",
              y="")
}
```


# Demographic data summary

In this section we will explore the global characteristics of respondents in our ExpMed  cohort. 
- We had a response rate  of  **41% (82/197)** based on the registered Experimental Medicine students for Spring 2021. Among responders, **74.4%** answered all the questions

```{r, echo=FALSE}
survey %>% 
  mutate(Progress=case_when(Progress<100 ~ "Partially complete", 
                            TRUE~ "Fully complete")) %>%
  count_wrapper(. , var=Progress) %>% 
  formatted_kbl()
```

### Type of graduate program and student type 

We see that PhD and MSc responders are in their majority domestic: 84.8 vs 15.2% in MSc program and 65.9% vs 34.1% in the PhD program. Also, we had a higher rate of PhD responders (55.4%) compared to MSc students (44.6%).

```{r}
count(survey1, Q17) %>% 
  mutate(freq=n/82*100) %>% 
  formatted_kbl(., colnames = c("Program", "n", "%"))

table(survey1$Q17, 
      survey1$Q18) %>%
  formatted_kbl()
```

### Year in the program

```{r}
## The levels were disorganized so I correct it before plotting

survey1<- survey1 %>% 
  mutate(
    Q72=gsub(x=Q72, pattern = ": Please Specify", replacement = ""),
    Q72=case_when(Q72 %in% c("Other","6","7") ~ "other",
                  TRUE ~ as.character(Q72)),
    Q72=forcats::fct_relevel(Q72, sort)
    )


# levels(survey1$Q72)
```

Most of the MSc responders are in the first 2 years of the degree (as expected) and PhD respondents are mostly in their second to fourth year of the program. Thus, early PhD students are probably not represented in the sample. 

```{r}
plots <- list()
plots$year1 <- filter(survey1, !is.na(Q17)) %>% 
  grouped_bar_wrapper(group=Q17, facet_label="right", x=Q72)
```

If we separate the results in International vs Domestic, most international students are in year 2 or beyond. Which is expected based on the public health situation limiting start of international students. 

```{r, echo=FALSE}
plots$year2 <-  filter(survey1, !is.na(Q18)) %>% 
  grouped_bar_wrapper(x=Q72, group=Q18, facet_label="right",
                   palette = "green")

ggarrange(plots$year1, plots$year2,
          nrow = 2) %>% 
  annotate_figure(top=text_grob("Year in ExpMed graduate program (n=74)",
                                size=16, face="bold"))
```

### Program start date

In this plot, we see the date of start in the X axis and the count of students in the Y-axis. Most of the MSc responders started in or after 2019. In contrast, start dates of PhD students are more evenly distributed.

```{r}
survey1 %>% 
  count(Q62, Q17) %>% 
  drop_na() %>% 
  ggplot(aes(x=Q62, y=n, colour=factor(Q17))) +
  geom_jitter(size=2.5) +
  labs(title="Date of program start (n=68)",
       y="Student count",
       x="Start date",
       colour="Program") +
  theme_classic() +
  scale_color_manual(values=c("darkcyan","brown3")) +
  theme(axis.title = element_text(size=12),
        plot.title = element_text(size=16, hjust=0.5))
```

# Program feedback

The following questions report student satisfaction with the program and will be summarized by graduate program and international status. 

```{r, eval=F}
# utils::View(questions_guide)
questions_guide %>% 
  slice(18:38) %>% 
  view()
```

### How reasonable or unreasonable is the tuition cost at this university?

In general, both MSc and Phd students found the tuition fees to be between somewhat reasonable, somewhat unreasonable and neither reasonable or unreasonable. 

Domestic students showed a tendency to find the tuition somewhat reasonable as shown in the graph (45.4%). 
```{r}
# By program
plots$tuition1<- filter(survey1, !is.na(Q4)) %>% 
  count(Q4, Q17) %>%
  mutate(Q4=fct_relevel(Q4, "Neither reasonable nor unreasonable", after = 2))  %>% 
  geom_hist_wrapper(x.var = Q4, group = Q17)
# By status
plots$tuition2<-filter(survey1, !is.na(Q4)) %>% 
  count(Q4, Q18) %>%
  mutate(Q4=fct_relevel(Q4, "Neither reasonable nor unreasonable", after = 2))  %>% 
  geom_hist_wrapper(x.var = Q4, group = Q18)

#plots
ggarrange(plots$tuition1, plots$tuition2,
          common.legend = T) %>% 
  annotate_figure(top = text_grob("How reasonable/unreasonable is the tuition", 
                                  hjust=0.5, size=16, face = "bold"))
```

### Overall, how satisfied or dissatisfied are you with the ExMed program?

The most common responses of satisfaction with the program were in the categories of Somewhat satisfied and Neither satisfied nor disatisfied. This distribution did not change according to domestic status or type of program

```{r, fig.width=9}
plots$satisf1 <- filter(survey1, !is.na(Q5)) %>%
  count(Q5, Q17) %>% 
  mutate(Q5=fct_relevel(Q5, "Extremely satisfied", after = 0)) %>% 
  geom_hist_wrapper(x.var = Q5, group = Q17, 
                    palette = "OrRd")

plots$satisf2 <- filter(survey1, !is.na(Q5)) %>%
  count(Q5, Q18) %>% 
  mutate(Q5=fct_relevel(Q5, "Extremely satisfied", after = 0)) %>% 
  geom_hist_wrapper(x.var = Q5, group = Q18, 
                    palette = "OrRd")

ggarrange(plots$satisf1, plots$satisf2,
          common.legend = T) %>% 
  annotate_figure(top = text_grob("How satisfied/dissatisfied are you with the ExMed program?", 
                                  hjust=0.5, size=16, face = "bold"))

```

### How likely are you to recommend this program to students considering graduate school options?

Interestingly, a majority of the students would not recommend the program to others (39%), while another 34% are neutral about recommending it. As we see in the plot, doctoral students were detractors of the program more frequently. 

In the question about how likely, from 1 to 10, were you to recommend the program to someone else. The score of answers from PhD students was lower (median=6) compared to those from the MSc program (median=7). These differences are non-significative in a nonparametric test (p=0.71). The likelihood of recommending the program is similar between international and domestic students 

```{r}
plots$recomend1<- 
  filter(survey1, !is.na(Q6_NPS_GROUP)) %>%
  mutate(Q6_NPS_GROUP=case_when(
    Q6_NPS_GROUP=="Detractor" ~"Not likely",
    Q6_NPS_GROUP=="Passive" ~"Neutral",
    Q6_NPS_GROUP=="Promoter" ~"Likely")) %>% 
  grouped_bar_wrapper(x=Q6_NPS_GROUP, group = Q17, facet_label = "right")

plots$recomend2<- 
filter(survey1, !is.na(Q6_NPS_GROUP)) %>%
  mutate(Q6_NPS_GROUP=case_when(
    Q6_NPS_GROUP=="Detractor" ~"Not likely",
    Q6_NPS_GROUP=="Passive" ~"Neutral",
    Q6_NPS_GROUP=="Promoter" ~"Likely")) %>% 
  grouped_bar_wrapper(x=Q6_NPS_GROUP, group = Q18, palette = "green", facet_label = "right")

ggarrange(plots$recomend1, plots$recomend2,
          common.legend = F, 
          nrow=2) %>% 
  annotate_figure(top = text_grob("How likely are you to recommend this program to students?", 
                                  hjust=0.5, size=14, face = "bold"))
```

### Did you attend an ExMed orientation?

51 out of 82 (51.2%) students attended an ExMed orientation. Only 23 (28%) explicitly stated that they did not attend an orientation meeting. 

```{r}
count_wrapper(survey1, Q36) %>% 
  formatted_kbl(colnames=c("Did you attend an ExMed orientation?",
                           "n", "%"))
```

### How easy has it been to find information you need about processes and requirements of the program?

In general, students answered that finding information about the program was somewhat easy. However, 12 (14.6%) of responders manifested that this process was somewhat difficult. 

```{r}
 filter(survey1, !is.na(Q71))  %>%
   mutate(Q71=fct_relevel(Q71, "Somewhat difficult", after=2),
          Q71=fct_relevel(Q71, "Extremely easy", after=0)) %>% 
   count(Q71) %>% 
   geom_hist_wrapper(x.var=Q71, y.var = n, 
                     title = "How easy has it been to find information about \nprocesses and requirements of the program?" )
```

### What courses have you taken to meet your requirements? 

Most of the students took coursed from the faculty of medicine, particularly the mandatory courses (MEDI 501, MEDI 502 & thesis courses). Only ~9% of the answers are about courses not listed. Maybe there is an opportunity for students to diversify their curriculum according to their interests. 

```{r}
q28 
read_csv("./input/q28_courses.taken.csv") %>% 
  filter(Answer!="Total") %>% 
  mutate(course= case_when(Answer=="MEDI 501"~"MEDI 501",
                           Answer=="MEDI 502"~"MEDI 502",
                           Answer=="MEDI 503"~"MEDI 503",
                           Answer=="Other courses (please specify)"~"non MEDI course",
                           TRUE~"other in MEDI")) %>% 
  group_by(course) %>% 
  summarise(n=sum(Count),
            freq=n/172*100)

q28 %>% formatted_kbl(colnames=c("Course taken to meet requirements", "n", "%")) 

  
q28 %>%
  ggplot(aes(x=course, y=n, fill=factor(course))) + geom_col() +
  labs(title="Courses taken to meet requirements", x="", y="") +
  scale_fill_brewer(palette="Set1") +
  theme(plot.title = element_text(size=16, hjust=0.5),
        panel.background = element_blank(),
        legend.position = "none",
        axis.text.x = element_text(angle=45, vjust=0.5),
        axis.line = element_line(colour = "black"))
```


### Were you able to register in all the courses you were interested in?

```{r}

survey1 %>%
  count(Q36, sort = T) %>%
  mutate(freq=n/82*100) %>% 
  formatted_kbl(colnames=c("Able to register in desired courses?", "n", "%"))

```

Most of the responders were able to register in their desired courses (64.6%). We could assume that there is enough availability of seats in the MEDI courses as these were the most popular ones among students.

### What was your experience with registering in courses outside of MEDI? 

```{r}
survey1 %>% 
  mutate(Q35=gsub(" \\(Please elaborate\\)", "", Q35)) %>% 
  count(Q35) %>%
  drop_na() %>% 
  formatted_kbl(colnames=c("Experience registering courses outside of MEDI?","n"))

```

Not a lot of answers (14) to make any interpretation. Most of the students probably did not have experience registering in courses outside of MEDI (68/82).

### What was your overall satisfaction with the courses you took?

```{r}

filter(survey1, !is.na(Q29)) %>% 
  mutate(Q29=fct_relevel(Q29, "Somewhat satisfied", after=1)) %>% 
  count(Q29) %>% 
  geom_hist_wrapper(x.var=Q29, y.var=n, rev_palette = T,
                    title = "What was your overall satisfaction \nwith the courses you took? (n=61)") + theme(axis.line = element_line(colour = "black"))

```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, eval=F,warning = F, 
                      message = F, eval=F, fig.align = 'center', fig.width = 9)
```


As we have seen in previous questions, the bulk of the answers seem to gravitate between 'neutral' and 'somewhat satisfied' opinions. Unsatisfaction with the courses taken is low (n<15)

### Do you feel that there should be more MEDI electives?

```{r}
count_wrapper(survey1, Q33) %>% 
  formatted_kbl(colnames = c("Do you feel that there should be more MEDI electives?",
                             "n", "%"))
```

In general, students desire more elective courses from the faculty of Medicine. It could be interesting to follow-up with an initiative about what kind of courses. Maybe voting for broad categories (qualitative research, bioinformatics, public health, health economics, etc.)

### We are interested in hearing about your relationship with your supervisor

```{r, fig.height=10}
q57<- read_csv(file = "./input/q57_supervisor_relationship.csv") %>%
  pivot_longer(
    cols = -c(Question, Total),
    names_to = "score",
    values_to = "count") %>% 
  # add new lines to improve plots
   mutate(Question=gsub("invested","invested\n", Question),
          Question=gsub("going to","going to\n", Question), 
          Question=gsub("feedback","feedback\n", Question), 
          Question=gsub("relationship","relationship\n", Question),
          score=gsub("1", "1 - No agreement", score),
          score=gsub("5", "5 - Complete agreement", score))
# plot first 3 questions 
plots$super1 <-  slice(q57, 1:15)  %>%  
  geom_hist_wrapper(x.var = score, y.var=count) + 
  facet_wrap(~Question, strip.position = "right")  +
  theme(legend.text = element_text(size=8))
# plot remaining ones
plots$super2 <- slice(q57, 16:30)  %>%
  geom_hist_wrapper(x.var = score, y.var=count) + 
  facet_wrap(~Question, strip.position = "right") +
  theme(legend.text = element_text(size=8))

ggarrange(plots$super1, plots$super2, 
          nrow=2, 
          common.legend = T, legend="right") %>% 
  annotate_figure(top = text_grob("Relationship with supervisor(s)", face="bold", size=16))
```

In this question, students show that they have a good relationship with their supervisors overall. They feel supported by them, comfortable enough to bring up difficult questions and feel that they have their best interests in mind. 

# Funding

The following questions contain information about the funding received by students
Unfortunately, most of the answers are open ended and need to be re-codified somehow or summarized in any other way.

```{r, eval=FALSE}
questions_guide %>% 
  slice(c(45,74)) %>% 
  view()
```

### What average range of funding (CAD$) have you been receiving considering external funds combined?

```{r}
plots$fund1 <- 
  filter(survey1, !is.na(Q20)) %>%
  mutate(Q20=fct_relevel(Q20, "Over $30,000 per year", after=0))%>%
  count(Q20, Q17) %>% 
  geom_hist_wrapper(x.var = Q20, y.var=n, palette = "YlOrRd") +
  facet_wrap(~Q17)

plots$fund2 <- 
  filter(survey1, !is.na(Q20)) %>%
  mutate(Q20=fct_relevel(Q20, "Over $30,000 per year", after=0))%>%
  count(Q20, Q18) %>% 
  geom_hist_wrapper(x.var = Q20, y.var=n, palette = "YlOrRd") +
  facet_wrap(~Q18)

ggarrange(plots$fund1, plots$fund1, 
          nrow=2,
          common.legend = T, legend = "right") %>% 
  annotate_figure(top=text_grob("What average range of funding (CAD$)\nhave you been receiving", size = 16))
```

The most frequent category selected for average funding receives is 20k-30k/year (36 43.9%), a similar number of participants responded >30k/year (11, 13.4%) and 18k-20k/year (10, 12.2%). Less than 5% reported receiving less than 18k/year. 

This overall distribution held when we separated the answers according to type of program and also by domestic/international status. However, PhD students do report receiving funding over 30k/year more frequently. 

### How often do you worry about funding/financial support for your studies and living?

```{r}
survey1<- survey1 %>% 
  mutate(
    Q27= factor(Q27,levels = c("Never","Sometimes","About half the time",
                               "Most of the time","Always"))
    )


  count(survey1, Q27)

filter(survey1, !is.na(Q27)) %>%
  count(Q27) %>% 
  geom_hist_wrapper(x.var = Q27, y.var=n, palette = "YlOrRd", 
                    title = "How often do you worry about funding/financial support\nfor your studies and living?") +
  theme(axis.line = element_line(colour = "black"))


```

According to the distribution, we see that international students tend to worry more often about funding compared to domestic ones. According to type of program, MSc seem to have less financial worries as the most common answer among this group was 'sometimes' compared to 'always' for the doctoral students. 

### Q53: To which funding opportunities have you applied to?

The most common funding schemes that students applied for are supervisor funding, faculty of medicine graduate awards and CGS (M/D) scholarships. 

```{r}
full_join(read_csv("./input/q53_funding.applied.csv"),
          read_csv("./input/q53_funding.received.csv"),
          by="Question")  %>% 
  mutate(Question=gsub(" \\(.*", "", Question),
         "% received"=(.[[3]]/.[[2]])) %>% 
  rename("Opportunity"=1,
         "Applied"=2,
         "Received"=3) %>% 
  formatted_kbl()
```

These same funding opportunities were the ones more commonly awarded according to student answers. 

# Impact of COVID-19 and wellbeing

### The COVID19 pandemic has affected my overall mood and mental well being?

```{r}
# reorder levels and add an explicit NA
survey1$Q77 <- 
  factor(survey1$Q77,
         levels=c("Strongly disagree","Disagree","Neutral","Agree","Strongly agree")) 

filter(survey1, !is.na(Q77)) %>% 
  count(Q77) %>% 
  geom_hist_wrapper(
    x.var = Q77, palette = "YlOrRd", 
    title="The COVID19 pandemic has affected\nmy overall mood and mental well being?") +
  theme(axis.line = element_line(colour = "black"))
```

As expected, most students agree with the statement that the pandemic has affected their overall wellbeing. In contrast, the impact of the pandemic is not that great in their academic performance and education, as we will see shortly.

### Impact of covid in education

We asked several questions about the impact of the pandemic on several aspects of the training, responders scored between __1: No agreement__ and __5: Complete agreement__

```{r, fig.height=10}
q67 <-  
  read_csv(file = "./input/q67_pandemic_experience.csv") %>% 
  pivot_longer(cols = -c(Question, Total),
               names_to = "score",
               values_to = "count") %>% 
  mutate(score=case_when(score=="1" ~ "1 - No agreement",
                         score=="5" ~ "5 - Complete agreement",
                         TRUE~as.character(score)),
         Question=str_replace(Question, " \\(.*", ""),
         Question=str_replace(Question, "(with|has)", "\\1\n"))

plots$covid1 <- slice(q67, 1:15) %>% 
  geom_hist_wrapper(x.var = score, y.var = count) +
  facet_wrap(~Question, strip.position = "right")
  
plots$covid2 <- slice(q67, 16:30) %>% 
  geom_hist_wrapper(x.var = score, y.var = count) +
  facet_wrap(~Question, strip.position = "right")

ggarrange(plots$covid1, plots$covid2, nrow = 2, common.legend = T, legend = "right") %>% 
  annotate_figure(
    top=text_grob(label="The following question asks about how the\nCOVID-19 pandemic has affected your academic experience", size=16))

```

We can see that our sample agrees almost completely that the pandemic had some kind of impact in their education, as shown in the 4th graph. Also, responders tend to agree that the workload has changes during the pandemic. In all other responses, there is an even distribution of agreement about the statements. 

### The following question asks about well-being, mental-health and academic resources available at UBC

```{r}
read_csv("./input/q55_wellbeing.known.csv") %>% 
  mutate("% recognition"=Total/82*100) %>% 
  filter(Total>15) %>% 
  rename("UBC service"=1, "Known by"=2) %>% 
  formatted_kbl()
```

```{r, eval=F}
read_csv("./input/q55_wellbeing.known.csv") %>% 
  filter(Total<15)
```

* The resources most well-known by _ExpMed_ students are UBC counselling, UBC health services, Library research commons and the G+PS workshops. 
* Resources for sexual violence or sexual assault are widely unknown according to the survey.
* Also, the less known service is the mistreatment office of the faculty of medicine. 

Students also provided their level of satisfaction for the services that they have used. Here, we show the results for the 4 resources most commonly used. 

```{r}
q55 <-  read_csv(file = "./input/q55_evaluation_resources_used.csv") %>% 
  pivot_longer(cols = -c(Question, Total),
               names_to = "score",
               values_to = "count") %>%
  mutate(Question=gsub("Grad.*tudies","G+PS", Question)) %>% 
  mutate(score=factor(score,
                      levels = c("Extremely Dissatisfied","Somewhat Dissatisfied", 
                                 "Neither", "Somewhat Satisfied", "Extremely Satisfied")))

geom_hist_wrapper(q55, x.var = score, y.var = count, 
                  title="Level of satisfaction with best-known\nwellbeing services") +
  facet_wrap(~Question, strip.position = "right")
```

The most used resources are the UBC student health services (n=23), the Library research commons (n=18), UBC counselling (n=17) and G+PS workshops (n=16). Among them, the histograms show that the users are mostly satisfied for all but UBC counselling. There may be some increased demand due to the pandemic, but it may be interesting to explore why?

### Q61 - We are interested in hearing about how you are doing/feeling in the program.

In this question, students ranked how much they agreed with every statement with __1: no agreement__ and __5:complete agreement__

```{r}
q61<- read_csv(file = "./input/q61_feeling_program.csv") %>%
  pivot_longer(cols = -c(Question, Total),
               names_to = "score",
               values_to = "count") %>% 
  mutate(
    score=case_when(score=="1"~"1 - No agreement",
                    score=="5"~"5 - Complete agreement",
                    TRUE ~ as.character(score))
    )

slice(q61, 1:15)  %>% 
  geom_hist_wrapper(x.var = score, y.var = count) +
  facet_wrap(~Question, strip.position = "right")

slice(q61, 16:30)  %>% 
  geom_hist_wrapper(x.var = score, y.var = count) +
  facet_wrap(~Question, strip.position = "right")

slice(q61, 31:40)  %>% 
  geom_hist_wrapper(x.var = score, y.var = count) +
  facet_wrap(~Question, strip.position = "right")




# plot first 3 questions 
slice(q61, 1:15)  %>% 
  ggplot( aes(x=score, y=count, fill=score) ) +
  geom_histogram(stat = "identity", position = "dodge") +
  facet_grid(~Question) +
  scale_fill_brewer(palette = "BuGn") +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank()) +
  theme(legend.position="bottom") +
  labs(fill=("Less (1) to 
complete (5) agreement"))

# plot remaining ones
slice(q61, 16:30)  %>% 
  ggplot( aes(x=score, y=count, fill=score) ) +
  geom_histogram(stat = "identity", position = "dodge") +
  facet_grid(~Question) +
  scale_fill_brewer(palette = "BuGn") +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank()) +
  theme(legend.position="bottom") +
  labs(fill=("Less (1) to 
complete (5) agreement"))

slice(q61, 31:40)  %>% 
  ggplot( aes(x=score, y=count, fill=score) ) +
  geom_histogram(stat = "identity", position = "dodge") +
  facet_grid(~Question) +
  scale_fill_brewer(palette = "BuGn") +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank()) +
  theme(legend.position="bottom") +
  labs(fill=("Less (1) to 
complete (5) agreement"))
  
```

Overall, responders feel confident to approach setbacks and feel capable of completing the program successfully. Where we see less grouping around positive answers is in feeling supported by faculty members and not feeling discouraged by setbacks. 

# Bullying and harrassment

### Q78 - Have you ever experienced bullying and harassment by a faculty member in the ExMED program?

```{r}
survey1<- survey1 %>% 
  mutate(
    Q78=case_when(
      Q78=="no, I have not experienced bullying and harassment" ~ "no",
      is.na(Q78) ~ "NA",
      TRUE ~"yes"))

survey1 %>% 
  count(Q78) %>% 
  mutate(freq=n/82*100) %>%
  rename("experienced_bullying?"="Q78") %>% 
  kable(digits=2)

```

The disclosure of bullying and harrassment was low, worth to explore as this was one of the resources that were highly unknown by the student sample. A significant portion (7, 8.54%) of all respondents have evidenced one of these episodes. 

### Q79 - Have you ever experienced bullying and harassment by a non-faculty member (i.e. student or staff) in the ExMED program whether it be in the classroom or your lab? 


```{r}
survey1 %>% 
  mutate(
    Q79=case_when(
      Q79=="no, I have not experienced bullying and harassment" ~ "no",
      is.na(Q79) ~ NA_character_,
      TRUE ~"yes")) %>% 
  count(Q79) %>% 
  mutate(freq=n/82*100) %>%
  rename("non-faculty bullying?"="Q79") %>% 
  kable(digits=2)
```

The percentage of responders that have experienced bullying by someone other than a member of the faculty in the program is pretty low. Less than 5%.

### Q80 - If you have experienced bullying and harassment, did you notify someone in a leadership position about the bullying and/or harassment? & Q81 - Were you satisfied with how the bullying and/or harassment grievance was resolved? 

```{r}
survey1 %>% 
  mutate(
    Q80=case_when(
      Q80=="No, I did not notify anyone" ~ "no",
      is.na(Q80) ~ NA_character_,
      TRUE ~"yes")) %>% 
  count(Q80) %>% 
  mutate(freq=n/82*100) %>%
  rename("notified to a leader?"="Q80") %>% 
  kable(digits=2)

survey1  %>% 
  mutate(
    Q81=case_when(
      Q81=="No (provide details below)" ~ "No",
      Q81=="Somewhat (provide details below)" ~ "Somewhat",
      Q81=="Yes (provide details below)" ~ "Yes",
      is.na(Q81) ~ NA_character_),
    Q81=factor(Q81, 
               levels = c("No","Somewhat","Yes"))) %>%
  count(Q81)  %>% 
  drop_na() %>% 
  ggplot(aes(x=Q81, y=n, fill=Q81 )) +
  geom_bar(stat="identity") +
  theme (legend.position = "none") +
  labs (title="Satisfied with resolution of bullying/harrassment?",
        y="",
        x="") +
  scale_fill_brewer(palette = "Spectral")

```

In the cases were someone experienced bullying (n=12) only 5 reported the fact to an authority figure. Furthermore, as we see in the barplot, the resolution of the cases was not satisfactory at least from the point of view of the implicated students. 
